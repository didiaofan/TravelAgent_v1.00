# æ™ºèƒ½æ—…è¡Œè§„åˆ’Agent

ä¸€ä¸ªåŸºäºLangGraphå’Œå¤§è¯­è¨€æ¨¡å‹çš„æ™ºèƒ½æ—…è¡Œè§„åˆ’ç³»ç»Ÿï¼Œèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·éœ€æ±‚è‡ªåŠ¨ç”Ÿæˆä¸ªæ€§åŒ–çš„æ—…è¡Œè¡Œç¨‹ï¼ŒåŒ…å«æ™¯ç‚¹æ¨èã€å¤©æ°”åˆ†æã€é¢„ç®—æ§åˆ¶å’Œè·¯çº¿ä¼˜åŒ–ç­‰åŠŸèƒ½ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

- ğŸ¤– **æ™ºèƒ½å¯¹è¯**: å¤šè½®å¯¹è¯æ”¶é›†ç”¨æˆ·éœ€æ±‚ï¼Œè‡ªåŠ¨è¡¥å…¨ç¼ºå¤±ä¿¡æ¯
- ğŸ¯ **ä¸ªæ€§åŒ–æ¨è**: åŸºäºç”¨æˆ·åå¥½å’Œæ™¯ç‚¹çƒ­åº¦æ™ºèƒ½æ¨èæ™¯ç‚¹
- ğŸŒ¤ï¸ **å¤©æ°”é€‚é…**: æ ¹æ®å®æ—¶å¤©æ°”è°ƒæ•´è¡Œç¨‹ï¼Œé¿å…æ¶åŠ£å¤©æ°”å½±å“
- ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ **å›¢é˜Ÿçº¦æŸ**: è€ƒè™‘å›¢é˜Ÿæˆå‘˜æ„æˆï¼ˆæˆäºº/å„¿ç«¥/è€äººï¼‰è°ƒæ•´è¡Œç¨‹å¼ºåº¦
- ğŸ’° **é¢„ç®—æ§åˆ¶**: æ™ºèƒ½æ§åˆ¶æ€»é¢„ç®—ï¼ŒåŒ…å«æ™¯ç‚¹ã€ä½å®¿ã€é¤é¥®ã€äº¤é€šè´¹ç”¨
- ğŸ—ºï¸ **è·¯çº¿ä¼˜åŒ–**: åŸºäºåœ°ç†ä½ç½®ä¼˜åŒ–æ¯æ—¥è¡Œç¨‹è·¯çº¿ï¼Œç¡®ä¿é¡ºè·¯é«˜æ•ˆ
- â° **æ—¶é—´ç®¡ç†**: è€ƒè™‘æ™¯ç‚¹å¼€æ”¾æ—¶é—´å’Œå»ºè®®æ¸¸ç©æ—¶é•¿ï¼Œåˆç†å®‰æ’æ—¶é—´

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
æ—…è¡ŒAgent/
â”œâ”€â”€ src/                      # æ ¸å¿ƒæºç 
â”‚   â”œâ”€â”€ main.py              # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ workflow.py          # LangGraphå·¥ä½œæµå®šä¹‰
â”‚   â”œâ”€â”€ models.py            # Pydanticæ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ llm_utils.py         # LLMå·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ poi_utils.py         # æ™¯ç‚¹å¤„ç†å·¥å…·
â”‚   â””â”€â”€ weather_classifier.py # å¤©æ°”åˆ†ç±»å™¨
â”œâ”€â”€ tools/                    # å¤–éƒ¨APIå·¥å…·é›†
â”‚   â”œâ”€â”€ base_tool.py         # å·¥å…·åŸºç±»
â”‚   â”œâ”€â”€ weather.py           # å’Œé£å¤©æ°”API
â”‚   â”œâ”€â”€ hotel.py             # é…’åº—æŸ¥è¯¢å·¥å…·
â”‚   â””â”€â”€ routeinf.py          # è·¯çº¿æŸ¥è¯¢å·¥å…·
â”œâ”€â”€ data/                     # æ•°æ®æ–‡ä»¶
â”‚   â””â”€â”€ beijing_poi.json     # åŒ—äº¬æ™¯ç‚¹æ•°æ®åº“
â”œâ”€â”€ tests/                    # æµ‹è¯•å¥—ä»¶
â”‚   â”œâ”€â”€ run_tests.py         # æµ‹è¯•è¿è¡Œå™¨
â”‚   â”œâ”€â”€ test_preference_filter.py  # åå¥½ç­›é€‰æµ‹è¯•
â”‚   â”œâ”€â”€ test_weather_filter.py     # å¤©æ°”è¿‡æ»¤æµ‹è¯•
â”‚   â””â”€â”€ ...                  # å…¶ä»–æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ config.py                # é…ç½®ç®¡ç†
â”œâ”€â”€ requirements.txt         # Pythonä¾èµ–
â””â”€â”€ README.md               # é¡¹ç›®æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. ç¯å¢ƒé…ç½®

åˆ›å»º`.env`æ–‡ä»¶å¹¶é…ç½®å¿…è¦çš„APIå¯†é’¥ï¼š

```bash
# OpenAI API (å¿…éœ€)
OPENAI_API_KEY=your_openai_api_key_here

# æ²ƒå¡å¹³å°API (å¯é€‰ï¼Œä½œä¸ºOpenAIå¤‡é€‰)
WOKA_API_BASE=https://4.0.wokaai.com/v1
WOKA_MODEL_NAME=gpt-3.5-turbo

# å’Œé£å¤©æ°”API (å¯é€‰ï¼Œç”¨äºå¤©æ°”æŸ¥è¯¢)
HEFENG_API_HOST=your_hefeng_host
HEFENG_API_KEY=your_hefeng_api_key

# å…¶ä»–APIå¯†é’¥ (é¢„ç•™)
WEATHER_API_KEY=your_weather_api_key
HOTEL_API_KEY=your_hotel_api_key
TRANSPORT_API_KEY=your_transport_api_key
```

### 3. è¿è¡Œç¨‹åº

```bash
python src/main.py
```

æˆ–è€…åœ¨ä»£ç ä¸­è°ƒç”¨ï¼š

```python
from src.main import run_travel_agent_multi_turn

# å•æ¬¡è§„åˆ’
user_input = "æˆ‘å¸¦å­©å­ä»ä¸Šæµ·åˆ°åŒ—äº¬ç©ä¸¤å¤©ï¼Œæ—¶é—´æ˜¯2025-08-17è‡³2025-08-18ï¼Œæƒ³å»æ•…å®«å’Œç¯çƒå½±åŸï¼Œé¢„ç®—8000å…ƒ"
result = run_travel_agent_multi_turn(user_input)
print(result)
```

## ğŸ§  å·¥ä½œæµèŠ‚ç‚¹

é¡¹ç›®é‡‡ç”¨LangGraphæ„å»ºçš„å¤æ‚å·¥ä½œæµï¼ŒåŒ…å«ä»¥ä¸‹å…³é”®èŠ‚ç‚¹ï¼š

### ä¿¡æ¯æ”¶é›†é˜¶æ®µ
- **parse_input**: è§£æç”¨æˆ·è¾“å…¥ï¼Œæå–ç»“æ„åŒ–ä¿¡æ¯
- **check_fields**: æ£€æŸ¥å¿…éœ€å­—æ®µå®Œæ•´æ€§
- **ask_question**: æ™ºèƒ½è¿½é—®ç¼ºå¤±ä¿¡æ¯

### çº¦æŸå¤„ç†é˜¶æ®µ
- **preference_filter**: åŸºäºç”¨æˆ·åå¥½å’Œæ™¯ç‚¹çƒ­åº¦ç­›é€‰å€™é€‰æ™¯ç‚¹
- **weather_filter**: æ ¹æ®å¤©æ°”æ¡ä»¶è¿‡æ»¤å®¤å¤–æ™¯ç‚¹
- **team_constraints**: æ ¹æ®å›¢é˜Ÿæ„æˆè®¾ç½®æ—¶é—´å’Œä½å®¿çº¦æŸ

### è¡Œç¨‹è§„åˆ’é˜¶æ®µ
- **route_feasibility**: è§„åˆ’æ™¯ç‚¹ã€é¤å…ã€é…’åº—å’Œäº¤é€šè·¯çº¿
- **time_window_check**: æ£€æŸ¥æ™¯ç‚¹å¼€æ”¾æ—¶é—´åŒ¹é…æ€§
- **intensity_check**: æ§åˆ¶æ¯æ—¥è¡Œç¨‹å¼ºåº¦
- **budget_check**: é¢„ç®—å¯è¡Œæ€§éªŒè¯

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€å¯¹è¯ç¤ºä¾‹

```
User: æˆ‘æƒ³å»åŒ—äº¬ç©3å¤©ï¼Œæœ‰ä»€ä¹ˆæ¨èå—ï¼Ÿ

Assistant: å¥½çš„ï¼ä¸ºäº†ç»™æ‚¨æ¨èæœ€åˆé€‚çš„è¡Œç¨‹ï¼Œæˆ‘éœ€è¦äº†è§£ä¸€äº›ä¿¡æ¯ï¼š
- æ‚¨çš„å‡ºå‘åŸå¸‚æ˜¯å“ªé‡Œï¼Ÿ
- è®¡åˆ’ä»€ä¹ˆæ—¶å€™å»åŒ—äº¬ï¼Ÿï¼ˆå…·ä½“æ—¥æœŸï¼‰
- å¤§æ¦‚çš„é¢„ç®—æ˜¯å¤šå°‘ï¼Ÿ
- ä¸€å…±å‡ ä¸ªäººï¼Ÿæœ‰è€äººæˆ–å°å­©å—ï¼Ÿ
- å¯¹æ™¯ç‚¹ç±»å‹æœ‰ä»€ä¹ˆåå¥½å—ï¼Ÿï¼ˆæ¯”å¦‚å†å²æ–‡åŒ–ã€ç°ä»£å¨±ä¹ã€è‡ªç„¶é£å…‰ç­‰ï¼‰

User: æˆ‘ä»ä¸Šæµ·å‡ºå‘ï¼Œ8æœˆ17æ—¥åˆ°8æœˆ19æ—¥ï¼Œé¢„ç®—8000å…ƒï¼Œæˆ‘å’Œæˆ‘8å²çš„å„¿å­ä¸¤ä¸ªäººã€‚å–œæ¬¢å†å²æ–‡åŒ–ï¼Œä½†ä¹Ÿæƒ³å¸¦å­©å­å»ç©ä¸€äº›æœ‰è¶£çš„åœ°æ–¹ã€‚

Assistant: å®Œç¾ï¼æˆ‘ä¸ºæ‚¨è§„åˆ’ä¸€ä¸ª3å¤©çš„åŒ—äº¬äº²å­æ–‡åŒ–ä¹‹æ—…...
[ç”Ÿæˆè¯¦ç»†è¡Œç¨‹]
```

### å®Œæ•´è¾“å…¥ç¤ºä¾‹

```python
# ä¿¡æ¯å®Œæ•´çš„ç”¨æˆ·è¾“å…¥
user_input = """
æˆ‘å¸¦å­©å­ä»ä¸Šæµ·åˆ°åŒ—äº¬ç©ä¸¤å¤©ï¼Œæ—¶é—´æ˜¯2025-08-17è‡³2025-08-18ï¼Œ
æƒ³å»æ•…å®«å’Œç¯çƒå½±åŸå’ŒåŒ—äº¬é‡ç”ŸåŠ¨ç‰©å›­ï¼Œåªæœ‰æˆ‘å’Œå­©å­2ä¸ªäººï¼Œ
ä¸¤å¤©é¢„ç®—8000å…ƒ
"""

result = run_travel_agent_multi_turn(user_input)
print(result)
```

## ğŸ§ª æµ‹è¯•åŠŸèƒ½

é¡¹ç›®åŒ…å«å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼Œå¯ä»¥å•ç‹¬æµ‹è¯•å„ä¸ªåŠŸèƒ½æ¨¡å—ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python tests/run_tests.py

# æµ‹è¯•åå¥½ç­›é€‰åŠŸèƒ½
python tests/test_preference_filter.py

# æµ‹è¯•å¤©æ°”è¿‡æ»¤åŠŸèƒ½  
python tests/test_weather_filter.py

# è°ƒè¯•æ™¯ç‚¹æ•°æ®åŠ è½½
python tests/debug_poi_loading.py
```

## ğŸ“Š æ•°æ®è¯´æ˜

### æ™¯ç‚¹æ•°æ®åº“ï¼ˆbeijing_poi.jsonï¼‰

åŒ…å«åŒ—äº¬50+çƒ­é—¨æ™¯ç‚¹çš„è¯¦ç»†ä¿¡æ¯ï¼š

```json
{
  "name": "æ•…å®«åšç‰©é™¢",
  "location": {"lat": 39.916345, "lng": 116.397155},
  "district": "ä¸œåŸåŒº",
  "tags": ["å†å²", "åšç‰©é¦†", "å¤å»ºç­‘"],
  "ticket_price": 60,
  "open_time": "08:30-17:00",
  "suggested_duration_hours": 4,
  "popularity_score": 0.95,
  "suitable_for": ["æˆäºº", "é’å°‘å¹´", "å„¿ç«¥"],
  "indoor": "å®¤å†…"
}
```

### å…³é”®å­—æ®µè¯´æ˜

- **popularity_score**: æ™¯ç‚¹çƒ­åº¦è¯„åˆ†ï¼ˆ0-1ï¼‰ï¼Œç”¨äºæ™ºèƒ½æ¨èæ’åº
- **suggested_duration_hours**: å»ºè®®æ¸¸ç©æ—¶é•¿ï¼Œç”¨äºæ—¶é—´è§„åˆ’
- **suitable_for**: é€‚åˆäººç¾¤ï¼Œç”¨äºå›¢é˜Ÿé€‚é…
- **indoor**: å®¤å†…/å®¤å¤–å±æ€§ï¼Œç”¨äºå¤©æ°”è¿‡æ»¤
- **tags**: æ™¯ç‚¹æ ‡ç­¾ï¼Œç”¨äºåå¥½åŒ¹é…

## ğŸ”§ æŠ€æœ¯æ ˆ

- **LangGraph**: æ„å»ºå¤æ‚çš„AIå·¥ä½œæµ
- **LangChain**: LLMåº”ç”¨å¼€å‘æ¡†æ¶
- **Pydantic**: æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–
- **OpenAI API**: å¤§è¯­è¨€æ¨¡å‹æœåŠ¡
- **Python 3.8+**: ç¼–ç¨‹è¯­è¨€

## ğŸ”„ ç‰ˆæœ¬å†å²

- **V1**: åŸºç¡€çš„LLMæ„å›¾æå–å’Œä¿¡æ¯è¡¥å…¨
- **V2**: å¢åŠ æ™¯ç‚¹åå¥½ç­›é€‰å’Œå›¢é˜Ÿçº¦æŸå¤„ç†
- **V3**: é‡æ„ä»£ç æ¶æ„ï¼Œå¢åŠ è·¯ç¨‹æ—¶é—´å’Œé¢„ç®—çº¦æŸ
- **V4**: å®Œå–„å·¥ä½œæµï¼Œå¢åŠ å¤©æ°”é€‚é…å’Œå…¨é¢æµ‹è¯•

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„å·¥å…·

åœ¨`tools/`ç›®å½•ä¸‹åˆ›å»ºæ–°å·¥å…·ï¼Œç»§æ‰¿`BaseTool`ï¼š

```python
from tools.base_tool import BaseTool
from typing import Dict, Any

class NewTool(BaseTool):
    def __init__(self, api_key: str):
        super().__init__(api_key)
    
    def execute(self, **kwargs) -> Dict[str, Any]:
        # å®ç°å·¥å…·é€»è¾‘
        return {"result": "success"}
```

### æ‰©å±•å·¥ä½œæµèŠ‚ç‚¹

åœ¨`src/workflow.py`ä¸­æ·»åŠ æ–°èŠ‚ç‚¹ï¼š

```python
def new_node(state: AgentState) -> AgentState:
    """æ–°èŠ‚ç‚¹åŠŸèƒ½"""
    # å®ç°èŠ‚ç‚¹é€»è¾‘
    return state

# åœ¨workflowä¸­æ³¨å†ŒèŠ‚ç‚¹
workflow.add_node("new_node", new_node)
```

### æ·»åŠ æµ‹è¯•

åœ¨`tests/`ç›®å½•ä¸‹åˆ›å»ºæ–°çš„æµ‹è¯•æ–‡ä»¶ï¼š

```python
import sys
import os
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

def test_new_feature():
    """æµ‹è¯•æ–°åŠŸèƒ½"""
    # æµ‹è¯•ä»£ç 
    pass

if __name__ == "__main__":
    test_new_feature()
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **APIå¯†é’¥å®‰å…¨**: è¯·å‹¿å°†çœŸå®APIå¯†é’¥æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
2. **ç½‘ç»œä¾èµ–**: å¤©æ°”æŸ¥è¯¢ç­‰åŠŸèƒ½éœ€è¦ç½‘ç»œè¿æ¥
3. **æ•°æ®æ›´æ–°**: æ™¯ç‚¹ä¿¡æ¯å¯èƒ½éœ€è¦å®šæœŸæ›´æ–°
4. **æ€§èƒ½ä¼˜åŒ–**: å¤§é‡æ™¯ç‚¹æ•°æ®å¯èƒ½å½±å“å“åº”é€Ÿåº¦

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ï¼š`git checkout -b feature/new-feature`
3. æäº¤æ›´æ”¹ï¼š`git commit -m 'Add new feature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/new-feature`
5. æäº¤Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ - è¯¦è§[LICENSE](LICENSE)æ–‡ä»¶

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤GitHub Issue
- å‘é€é‚®ä»¶è‡³å¼€å‘è€…
- åœ¨é¡¹ç›®è®¨è®ºåŒºäº¤æµ

---

**Happy Traveling! ğŸ’âœˆï¸**